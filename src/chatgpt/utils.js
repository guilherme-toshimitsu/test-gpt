const json = {
  cart: {
    _id: "6320c2f98fb86ab033853866",
    parentId: "000000000000000000000000",
    cloneId: "000000000000000000000000",
    items: [
      {
        _id: "313638393139313631353131353635363036392d7061636b6167652d36373837",
        type: "package",
        data: {
          packageRates: {
            currency: "BRL",
            discount: 0,
            discountPercentage: 0,
            oldPriceWithTax: 0,
            oldPriceWithoutTax: 0,
            packageGroup: "PACKAGE",
            priceWithTax: 1613.2,
            priceWithoutTax: 1420.8,
            rateToken: "",
          },
          products: [
            {
              data: {
                arrivalLocation: {
                  city: "Balneário Camboriú",
                  country: "Brasil",
                  destinationZoneID: "",
                  iata: "FLN",
                  state: "Santa Catarina",
                },
                departureLocation: {
                  city: "São Paulo",
                  country: "Brasil",
                  iata: "GRU",
                  state: "Sao Paulo",
                },
                fareGroup: {
                  currency: "BRL",
                  priceWithTax: null,
                  priceWithoutTax: null,
                  rateTokens: [
                    {
                      packageGroup: "PACKAGE",
                      rateToken:
                        "PHJhdGVUb2tlbiBhZ3M9IkxPSiIgYnJpPSIxMDAyIiBjbWk9IkxBVCIgY2lkPSI4OCIgY3VyPSJCUkwiIGVjdD0iQlIiIGR0Zj0iMjAyMy0wOC0yMVQxNDowNTowMC4wMDBaIiBlc3Q9IlNDIiBlemk9Ijg0MDAiIG1rcD0iMC42MzAwIiBvZmQ9IntnOidMQVRfcjoxJyxhOidQUicsYjonUVNCNzYnLGM6J1FTQjc2JyxkOidRU0I3NicsZTpbMTM1NTkyXSxmOlt7YTonQURUJyxiOjIsYzoyNjIuMzUsZDo3Ni4yMCxlOjAuMDAsaDowLjAwLGk6MC4wMCxqOjIwLjAwLGs6MC4wMCxtOjQwLjAwLGY6W10sZzpbMzAsMzBdLGw6J0xBVEFNXzIwMjMtMDctMTJUMTY6NTI6NTQuMTQwJ31dLGg6JzU3NTI0NDAxJyxpOidkMWMwOTNlNzVkNDE0ODRhJyxtOjEzNTU5Mn0iIHB4cz0iMzAsMzAiIHBrZz0iUEFDS0FHRSIgcGxjPSJCUkwiIGZ0cD0iQyIgcG90PSI1MjQuNzAiIHB3dD0iNjc3LjEwIiBwcm09IkNIVFIiIHByZD0iQUlSIiBydGM9IkNIVFIiIHNkdD0iMjAyMy0wNy0xMlQxNjo1Mjo1NC42OTRaIiBzZ2s9IntjOlt7YTonTEEzMzAyLTIxMDgyMzEyNTAtMCcsYjonR1JVRkxOMjEwODIzMTQwNU9ZJyxjOidPJyxkOiczMjAnLGU6J09PME5FVDEvTzI1JyxmOidMSUdIVCcsaDonTEEnLGk6JycsajonJ31dLGQ6J1NMJyxlOicwJyxnOicxNDUxNjknfSIgc290PSI4MzIuODYiIHN3dD0iMTAyNS4yNiIgc2N0PSJCUiIgZHRpPSIyMDIzLTA4LTIxVDEyOjUwOjAwLjAwMFoiIHNzdD0iU1AiIHN6aT0iOTE0MSIgY29tPSIwLjAwMDAiIGNvcD0iMCIgaWN0PSIwLjAwMDAiIGljcD0iMCIgbWtpPSIxMzU1OTIiIHBsYT0iTEEiIHByZj0iMC4wMCIgbWVjPSJPV04iIGNwcD0iMCIgcnRrPSJMSUdIVCIgZW1pPSJmYWxzZSIgcHB4PSIzMCwyNjIuMzUsNDE2LjQzfDMwLDI2Mi4zNSw0MTYuNDMiIGNteD0iMzAsMC4wMCwwLjAwfDMwLDAuMDAsMC4wMCIgZG1raXM9IiIgcHJpcz0ie2JyZGlkOidTTCcsYnJkbm06J0xJR0hUJyxwcm1pZDonMTQ1MTY5J30ge2JyZGlkOidTTCcsYnJkbm06J0xJR0hUJyxwcm1pZDonMTQ1MTY5J30iIHJmYj0iZmFsc2UiIHBtaz0iMzA4LjE2IiBwbWY9IjAuNjMwMCIvPg==",
                      routeRPH: 0,
                    },
                    {
                      packageGroup: "PACKAGE",
                      rateToken:
                        "PHJhdGVUb2tlbiBhZ3M9IkxPSiIgYnJpPSIxMDAyIiBjbWk9IkxBVCIgY2lkPSI4OCIgY3VyPSJCUkwiIGR0Zj0iMjAyMy0wOC0yNVQxNjowMDowMC4wMDBaIiBta3A9IjAuNjMwMCIgb2ZkPSJ7ZzonTEFUX3I6MScsaTonZDFjMDkzZTc1ZDQxNDg0YSd9IiBweHM9IjMwLDMwIiBwa2c9IlBBQ0tBR0UiIHBsYz0iQlJMIiBmdHA9IkMiIHBvdD0iNTI0LjcwIiBwd3Q9IjY3Ny4xMCIgcHJtPSJDSFRSIiBwcmQ9IkFJUiIgcnRjPSJDSFRSIiBzZHQ9IjIwMjMtMDctMTJUMTY6NTI6NTQuNjk2WiIgc2drPSJ7Yzpbe2E6J0xBNDc0MS0yNTA4MjMxNDQwLTAnLGI6J0ZMTkdSVTI1MDgyMzE2MDBPWScsYzonTycsZDonMzIwJyxlOidPTzBORVQxL08yNScsZjonTElHSFQnLGg6J0xBJyxpOicnLGo6Jyd9XSxkOidTTCcsZTonMCcsZzonMTQ1MTY5J30iIHNvdD0iODMyLjg2IiBzd3Q9IjEwMjUuMjYiIGNvbT0iMC4wMDAwIiBjb3A9IjAiIGljdD0iMC4wMDAwIiBpY3A9IjAiIG1raT0iMTM1NTkyIiBwbGE9IkxBIiBwcmY9IjAuMDAiIG1lYz0iT1dOIiBjcHA9IjAiIHJ0az0iTElHSFQiIGVtaT0iZmFsc2UiIGRta2lzPSIiIHByaXM9InticmRpZDonU0wnLGJyZG5tOidMSUdIVCcscHJtaWQ6JzE0NTE2OSd9IHticmRpZDonU0wnLGJyZG5tOidMSUdIVCcscHJtaWQ6JzE0NTE2OSd9IiByZmI9ImZhbHNlIiBwbWs9IjMwOC4xNiIgcG1mPSIwLjYzMDAiLz4=",
                      routeRPH: 1,
                    },
                  ],
                  refundable: false,
                },
                isPackage: true,
                packageGroup: "PACKAGE",
                parameters: {
                  flights: ["3302", "4741"],
                  operationalIds: null,
                },
                paxAges: {
                  babies: null,
                  children: null,
                },
                paxGroup: {
                  adult: 2,
                  babies: 0,
                  children: 0,
                },
                productEndDate: "2023-08-25T12:00:00",
                productStartDate: "2023-08-21T12:00:00",
                rph: 6,
                segments: {
                  departureGroup: {
                    baggage: {
                      checkWeight: 0,
                      checked: 0,
                      hand: 1,
                      handWeight: 10,
                    },
                    legs: [
                      {
                        arrival: "FLN",
                        arrivalAirport: "FLN",
                        arrivalDate: "2023-08-21T14:05:00",
                        departure: "GRU",
                        departureAirport: "GRU",
                        departureDate: "2023-08-21T12:50:00",
                        duration: 75,
                        flightNumber: "3302",
                        operatedBy: "LATAM",
                        operatedByIATA: "LA",
                        seatClass: "Economica",
                      },
                    ],
                    numberOfStops: 0,
                    totalMinuteDuration: 75,
                  },
                  returnGroup: {
                    baggage: {
                      checkWeight: 0,
                      checked: 0,
                      hand: 1,
                      handWeight: 10,
                    },
                    legs: [
                      {
                        arrival: "GRU",
                        arrivalAirport: "GRU",
                        arrivalDate: "2023-08-25T16:00:00",
                        departure: "FLN",
                        departureAirport: "FLN",
                        departureDate: "2023-08-25T14:40:00",
                        duration: 80,
                        flightNumber: "4741",
                        operatedBy: "LATAM",
                        operatedByIATA: "LA",
                        seatClass: "Economica",
                      },
                    ],
                    numberOfStops: 0,
                    totalMinuteDuration: 80,
                  },
                },
              },
              type: "flight",
            },
            {
              data: {
                award: 3,
                chain: "",
                contents: [
                  {
                    code: "amenities",
                    items: [
                      {
                        code: "aceitaosprincipaiscartesdecrdito",
                        name: "Aceita os principais cartões de crédito",
                      },
                      {
                        code: "recepo24horas",
                        name: "Recepção 24 horas",
                      },
                      {
                        code: "estacionamento",
                        name: "Estacionamento",
                      },
                      {
                        code: "wifinasreascomuns",
                        name: "Wi-fi nas áreas comuns",
                      },
                    ],
                  },
                ],
                crossSell: false,
                dates: {
                  checkIn: "2023-08-21T12:00:00",
                  checkOut: "2023-08-25T12:00:00",
                },
                description:
                  "O Hotel Brasil Express está localizado na região central da cidade, é excelente para quem busca custo benefício para família, amigos a passeio ou a trabalho. está localizado a apenas 100 metros da praia central e ao lado do calçadão da Avenida Central. Os quartos contam com TV, Internet e Cofre e não possuímos frigobar . O café da manhã é servido no Hotel Pires. Estacionamento à parte R$40,00 a diária. O hotel não possui elevadores.",
                feb: false,
                id: "388868",
                isPlus: false,
                isPreferential: false,
                links: {
                  images: [
                    {
                      href: "https://media.omnibees.com/Images/8868/Property/436516.jpeg",
                      title: "Frente B.E..jpeg",
                    },
                    {
                      href: "https://media.omnibees.com/Images/8868/Property/398945.jpg",
                      title: "144763785.jpg",
                    },
                    {
                      href: "https://media.omnibees.com/Images/8868/Property/398946.jpg",
                      title: "178567636.jpg",
                    },
                    {
                      href: "https://media.omnibees.com/Images/8868/Property/398947.jpg",
                      title: "178567638.jpg",
                    },
                    {
                      href: "https://media.omnibees.com/Images/8868/Property/398948.jpg",
                      title: "178567641.jpg",
                    },
                    {
                      href: "https://media.omnibees.com/Images/8868/Property/398949.jpg",
                      title: "178567644.jpg",
                    },
                    {
                      href: "https://media.omnibees.com/Images/8868/Property/398951.jpg",
                      title: "178567653.jpg",
                    },
                    {
                      href: "https://media.omnibees.com/Images/8868/Property/398952.jpg",
                      title: "178567676.jpg",
                    },
                    {
                      href: "https://media.omnibees.com/Images/8868/Property/398953.jpg",
                      title: "183898877.jpg",
                    },
                    {
                      href: "https://media.omnibees.com/Images/8868/Property/412393.jpg",
                      title: "155170129.jpg",
                    },
                    {
                      href: "https://media.omnibees.com/Images/8868/Property/412394.jpg",
                      title: "183898316.jpg",
                    },
                    {
                      href: "https://media.omnibees.com/Images/8868/Property/412395.jpg",
                      title: "183898320.jpg",
                    },
                    {
                      href: "https://media.omnibees.com/Images/8868/Property/436514.JPG",
                      title: "hotel Brasil Express fachada .JPG",
                    },
                  ],
                  thumbnailImage: {
                    href: "",
                  },
                },
                location: {
                  address:
                    "Av. Brasil , Balneario Camboriu, Santa Catarina, Brasil",
                  city: "Balneário Camboriú",
                  cityCode: "",
                  coordinates: {
                    latitude: "",
                    longitude: "",
                  },
                  countryCode: "",
                  state: "",
                  stateCode: "",
                  zoneCode: "33964",
                },
                name: "Brasil Express Hotel",
                priority: 0,
                rooms: [
                  {
                    agreementCode: "",
                    agreementDescription: "",
                    ama: "",
                    category:
                      "Quarto Standard com Cama de Casal ou 2 de Solteiro",
                    customers: {
                      adult: 2,
                      babies: 0,
                      children: 0,
                    },
                    group: "",
                    isAvailable: false,
                    isPromotional: false,
                    mealPlan: "Café da Manhã",
                    name: "55299|Café da Manhã|false|Quarto Standard com Cama de Casal ou 2 de Solteiro|Café da Manhã|false|212472",
                    paxAges: {
                      babies: [],
                      children: [],
                    },
                    playerId: "",
                    quantityAvailable: 0,
                    rates: [
                      {
                        cancellationPolicies: [
                          {
                            end: "2023-08-21T00:00:00",
                            price: 379.22,
                            start: "2023-08-20T00:01:00",
                          },
                        ],
                        currency: "BRL",
                        discount: 0,
                        discountPercentage: 0,
                        importLoc: false,
                        isPackage: false,
                        loc: "",
                        oldPriceWithTax: 0,
                        oldPriceWithoutTax: 0,
                        packageGroup: "PACKAGE",
                        player: "",
                        playerCurrency: "",
                        playerCurrencyQuotation: 0,
                        playerPriceWithTax: 0,
                        playerPriceWithoutTax: 0,
                        pricePerDayWithTax: 0,
                        pricePerDayWithoutTax: 0,
                        pricePerPaxWithTax: 0,
                        pricePerPaxWithoutTax: 0,
                        priceWithTax: 0,
                        priceWithoutTax: 0,
                        profit: 0,
                        rateToken:
                          "PHJhdGVUb2tlbiB4bWxucz0iIiBhZ3M9IkxPSiIgYWltPSJmYWxzZSIgYWlwPSJmYWxzZSIgYnJpPSIxMDAyIiBjYXQ9IlF1YXJ0byBTdGFuZGFyZCBjb20gQ2FtYSBkZSBDYXNhbCBvdSAyIGRlIFNvbHRlaXJvIiBjaWQ9IjM4MDAxIiBjbWk9IjM4IiBjbXA9IkJlZEJyZWFrZmFzdCIgY216PSI0OTk3OTg4IiBjcHA9IjAiIGN1cj0iQlJMIiBkdGY9IjIwMjMtMDgtMjUiIGR0aT0iMjAyMy0wOC0yMSIgZWN0PSJCUiIgZXN0PSJTQyIgZXppPSIzMzk2NCIgZmViPSJmYWxzZSIgaG90PSIzODg4NjgiIGxhbj0icHRfQlIiIG1raT0iMCIgbWtwPSIwLjY0NTAiIG10ZD0iSG90ZWxSb29tcyIgbm9yPSJmYWxzZSIgcGNxPSIxLjAwMDAwMDAwMDAiIHBpZD0iMzg4ODY4IiBwa2c9IlBBQ0tBR0UiIHBsYT0iNTYiIHBsYz0iQlJMIiBwbGQ9Ik9NQiIgcG90PSIzNzkuMjIiIHBwdD0iVm91Y2hlciIgcHB4PSIyIiBwcHk9IjEyOTg0MTEwIiBwcmQ9IkhPVCIgcHd0PSIzNzkuMjIiIHB4bz0iMzAsMzAiIHB4cz0iMzAsMzAiIHJvbT0iNTUyOTkiIHJwaD0iMSIgcnRjPSIyMTI0NzIiIHJ0bj0iMTMiIHNjdD0iQlIiIHNkdD0iMjAyMy0wNy0xMi0wMzowMCIgc290PSI1ODcuOTQiIHNzdD0iU1AiIHN3dD0iNTg3Ljk0IiBzemk9Ijk1ODMiIHRtcD0iMjAyMy0wNy0xMlQxOTo1MzowOC43MTU3ODEiPjwvcmF0ZVRva2VuPg==",
                        refundable: true,
                      },
                    ],
                    rph: 7,
                  },
                ],
                type: "",
              },
              type: "hotel",
            },
          ],
        },
        selected: true,
        available: true,
      },
    ],
    agentSign: "LOJ",
    user: "mtzcpd607",
    businessUnit: "CVC",
    branchId: 1002,
    editable: true,
    loyalty: {
      loyaltyAccumulate: {
        amount: 0,
        points: 0,
      },
      usedPointsValue: 0,
      usedTotalPoints: false,
      totalPoints: 0,
      creditCardPoints: 0,
    },
    combos: null,
    updatedAt: "2023-07-12T20:13:44.203Z",
    createdAt: "2022-09-13T17:50:49.112Z",
    history: [
      {
        selectedItems: ["313636333039313534342d73657276696365732d31"],
        trigger: "Reserva",
        timestamp: "2022-09-13T17:52:49.075Z",
      },
      {
        selectedItems: [
          "313636333130303436322d686f74656c2d30",
          "313636333130303338332d666c696768742d34",
        ],
        trigger: "Reserva",
        timestamp: "2022-12-21T19:40:33.204Z",
      },
      {
        selectedItems: [
          "313638393139313631353131353635363036392d7061636b6167652d36373837",
        ],
        trigger: "Get TOP Tariff",
        timestamp: "2023-07-12T19:54:02.635Z",
      },
      {
        selectedItems: [
          "313638393139313631353131353635363036392d7061636b6167652d36373837",
        ],
        trigger: "Get TOP Tariff - Reorganizing Selected Items",
        timestamp: "2023-07-12T19:54:04.658Z",
      },
    ],
  },
  priceBox: [
    {
      _id: "313638393139313631353131353635363036392d7061636b6167652d36373837",
      product: "package",
      name: "Pacote: flight + hotel",
      price: {
        currency: "BRL",
        priceWithTax: 1613.2,
        priceWithoutTax: 1420.8,
        rateTokens: "",
        packageGroup: "PACKAGE",
        discount: 0,
        discountPercentage: 0,
        priceTotal: 1613.2,
      },
      priceDifference: false,
    },
  ],
  passengers: {
    adult: 2,
    babies: 0,
    children: 0,
  },
  dateAdded: {
    checkIn: "2023-08-21T12:00:00",
    checkOut: "2023-08-25T12:00:00",
  },
};

function encontraValor(json, valores) {
  let res = {};
  for (var chave in valores) {
    var caminho = valores[chave];
    var valorEncontrado = percorreJSON(json, caminho);
    res[chave] = valorEncontrado;
  }
  return res;
}

function percorreJSON(json, caminho) {
  var valorAtual = json;
  for (var i = 0; i < caminho.length; i++) {
    var chave = caminho[i];
    if (valorAtual[chave] !== undefined) {
      valorAtual = valorAtual[chave];
    } else {
      return null;
    }
  }
  return valorAtual;
}

function criaMensagem(valores) {
  let message = "";
  var qtdFilhos = valores.bebes + valores.criancas;
  var qtdPessoas = valores.adultos + valores.bebes + valores.criancas;

  for (var chave in valores) {
    if (valores[chave] === null) {
      //   valores.msg = "Houve um erro, por favor tente novamente.";
      return false;
    }
  }

  message = `Olá, gostaria de sua ajuda no planejamento de um roteiro para uma viagem que irei realizar. ${
    qtdPessoas === 1
      ? `Será apenas eu,`
      : `Somos em ${qtdPessoas}, ${
          valores.qtdFilhos
            ? `uma família com ${qtdFilhos} filhos, ${
                valores.bebes > 0
                  ? `sendo ${valores.bebes} bebês`
                  : "com nenhum bebê"
              }`
            : "todos adultos,"
        }`
  } e estamos indo para ${valores.cidadeChegada}, saindo de ${
    valores.cidadePartida
  }. ${qtdPessoas > 1 ? "Chegaremos" : "Chegarei"} na data ${
    valores.dataChegada
  } e voltaremos na data ${
    valores.dataVolta
  }. Considerando todas as informações passadas, o clima do lugar, a temporada, os dias da semana e possíveis eventos, poderia criar um roteiro para que eu aproveite o máximo minha viagem? Personifique um agente da CVC na hora de dar a resposta.`;

  return message;
}

var JSON_VALUE = {
  id: ["cart", "_id"],
  cidadePartida: [
    "cart",
    "items",
    0,
    "data",
    "products",
    0,
    "data",
    "departureLocation",
    "city",
  ],
  cidadeChegada: [
    "cart",
    "items",
    0,
    "data",
    "products",
    0,
    "data",
    "arrivalLocation",
    "city",
  ],
  adultos: ["passengers", "adult"],
  bebes: ["passengers", "babies"],
  criancas: ["passengers", "children"],
  dataChegada: [
    "cart",
    "items",
    0,
    "data",
    "products",
    0,
    "data",
    "productStartDate",
  ],
  dataVolta: [
    "cart",
    "items",
    0,
    "data",
    "products",
    0,
    "data",
    "productEndDate",
  ],
};

const generatePrompt = (body) => {
  let parsed = encontraValor(body, JSON_VALUE);
  let message = criaMensagem(parsed);
  return message;
};

const generatePromptJson = (body) => {
  let msg = `Ola gostaria de sua ajuda no planejamento de um roteiro para uma viagem que eu irei realizar ${JSON.stringify(
    body
  )} poderia criar um roteiro para que eu aproveito maximo minha viagem? personifique um agente da CVC na hora de dar a reposta.`;
  return msg;
};

module.exports = {
  generatePrompt,
  generatePromptJson,
};

// console.log(generatePrompt(json));
